<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vale Futebol Manager 2026</title>

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <script>
      (function () {
        if (!window.TeamUi) window.TeamUi = {};
        if (!window.TeamUI) window.TeamUI = window.TeamUi;
        if (typeof window.__TEAM_UI_REAL__ === "undefined") window.__TEAM_UI_REAL__ = false;

        function fallbackSelection() {
          alert(
            "A seleção de time ainda não carregou.\n\n" +
            "Clique em DEBUG para ver o relatório."
          );
        }

        if (typeof window.TeamUi.renderTeamSelection !== "function") {
          window.TeamUi.renderTeamSelection = fallbackSelection;
        }
        window.TeamUI.renderTeamSelection = window.TeamUi.renderTeamSelection;

        function loadScript(url) {
          return new Promise((resolve, reject) => {
            const s = document.createElement("script");
            const sep = url.includes("?") ? "&" : "?";
            s.src = url + sep + "v=" + Date.now();
            s.async = true;
            s.onload = () => resolve(url);
            s.onerror = () => reject(new Error("Falha ao carregar: " + url));
            document.head.appendChild(s);
          });
        }

        async function ensureTeamUIRealLoaded() {
          if (window.__TEAM_UI_REAL__ === true) return { ok: true, loadedFrom: "already-loaded" };
          const candidates = ["Ui/team-ui.js", "ui/team-ui.js", "UI/team-ui.js"];
          const tried = [];
          for (const c of candidates) {
            tried.push(c);
            try {
              await loadScript(c);
              if (window.__TEAM_UI_REAL__ === true && typeof window.TeamUi.renderTeamSelection === "function") {
                return { ok: true, loadedFrom: c, tried };
              }
            } catch (e) {}
          }
          return { ok: false, tried };
        }

        window.__ensureTeamUIRealLoaded = ensureTeamUIRealLoaded;

        document.addEventListener("DOMContentLoaded", () => {
          const btn = document.getElementById("btn-iniciar");
          if (btn && !btn.__vfBound) {
            btn.__vfBound = true;
            btn.addEventListener("click", async () => {
              const res = await ensureTeamUIRealLoaded();
              if (!res.ok) {
                alert(
                  "Não consegui carregar o Team UI real.\n\n" +
                  "Tentativas:\n- " + res.tried.join("\n- ")
                );
                return;
              }
              try {
                if (window.TeamUi && typeof TeamUi.renderTeamSelection === "function") TeamUi.renderTeamSelection();
                else if (window.TeamUI && typeof TeamUI.renderTeamSelection === "function") TeamUI.renderTeamSelection();
                else alert("Team UI carregou mas não registrou renderTeamSelection.");
              } catch (e) {
                alert("Erro ao abrir seleção: " + (e && e.message ? e.message : e));
              }
            });
          }

          const dbg = document.getElementById("vf-debug-open");
          if (dbg && !dbg.__vfBound) {
            dbg.__vfBound = true;
            dbg.addEventListener("click", async () => {
              try {
                if (window.DebugPanelUI && typeof DebugPanelUI.open === "function") {
                  DebugPanelUI.open();
                  return;
                }
              } catch (e) {}

              const capa = document.querySelector("img.capa-img");
              const capaOk = !!(capa && capa.complete && capa.naturalWidth > 0);
              const dbTeamsOk = !!(window.Database && Array.isArray(Database.teams) && Database.teams.length > 0);

              let msg = "DEBUG (rápido)\n\n";
              msg += "Capa carregada: " + (capaOk ? "SIM" : "NÃO") + "\n";
              msg += "Database.teams: " + (dbTeamsOk ? ("SIM (" + Database.teams.length + ")") : "NÃO") + "\n";
              msg += "__TEAM_UI_REAL__: " + window.__TEAM_UI_REAL__ + "\n";
              msg += "TeamUi.renderTeamSelection: " + (typeof window.TeamUi?.renderTeamSelection) + "\n\n";

              const res = await ensureTeamUIRealLoaded();
              msg += "Auto-load TeamUI: " + (res.ok ? ("OK (" + res.loadedFrom + ")") : "FALHOU") + "\n";
              msg += "Tentativas:\n- " + (res.tried ? res.tried.join("\n- ") : "n/a");
              alert(msg);
            });
          }
        });
      })();
    </script>
</head>

<body>
    <div id="tela-capa" class="tela ativa">
        <img src="assets/geral/capa.png" class="capa-img" alt="Capa do jogo">

        <button id="btn-iniciar" class="btn-principal">INICIAR CARREIRA</button>
        <button id="btn-continuar" class="btn-secundario">CONTINUAR CARREIRA</button>
        <button id="btn-carregar-json" class="btn-secundario">CARREGAR CARREIRA (JSON)</button>
        <input type="file" id="input-save-json" accept="application/json" style="display:none">
    </div>

    <div id="tela-escolha-time" class="tela">
        <h1 class="titulo">ESCOLHA SEU TIME</h1>
        <div id="lista-times" class="lista-times"></div>
        <button class="btn-voltar" onclick="UI.voltarParaCapa()">VOLTAR</button>
    </div>

    <div id="tela-lobby" class="tela">
        <div class="lobby-card">
            <img id="lobby-logo" class="lobby-logo" alt="Escudo do time">
            <div class="lobby-info-time">
                <h2 id="lobby-nome-time"></h2>
                <p id="lobby-temporada"></p>
                <p id="lobby-saldo"></p>
            </div>

            <div class="lobby-botoes">
                <button class="btn-green" onclick="UI.abrirProximoJogo()">PRÓXIMO JOGO</button>
                <button class="btn-blue"  onclick="UI.abrirClassificacao()">TABELA</button>
                <button class="btn-blue"  onclick="UI.abrirElenco()">ELENCO</button>
                <button class="btn-blue"  onclick="UI.abrirMercado()">MERCADO</button>
                <button class="btn-blue"  onclick="UI.abrirCalendario()">CALENDÁRIO</button>
                <button class="btn-gold"  onclick="UI.abrirTaticas()">TÁTICAS</button>
                <button class="btn-secundario" onclick="UI.salvarCarreira()">SALVAR CARREIRA</button>
                <button class="btn-voltar" onclick="UI.voltarParaCapa()">SAIR</button>
            </div>
        </div>
    </div>

    <div id="tela-mercado" class="tela">
        <h1 class="titulo">MERCADO DE TRANSFERÊNCIAS</h1>

        <div class="filtros-mercado">
            <label>
                Posição
                <select id="filtro-posicao">
                    <option value="todos">Todos</option>
                    <option value="GOL">Goleiro</option>
                    <option value="ZAG">Zagueiro</option>
                    <option value="LD">Lateral Direito</option>
                    <option value="LE">Lateral Esquerdo</option>
                    <option value="VOL">Volante</option>
                    <option value="MEI">Meia</option>
                    <option value="ATA">Atacante</option>
                </select>
            </label>

            <label>
                Mín. OVR
                <input id="filtro-min-ovr" type="number" value="70" min="40" max="99">
            </label>

            <label>
                Máx. valor (mi)
                <input id="filtro-max-valor" type="number" value="10" min="0" step="0.5">
            </label>

            <label>
                <input id="filtro-premium" type="checkbox">
                Pacote premium (só craques)
            </label>
        </div>

        <div id="lista-mercado" class="lista-mercado"></div>
        <button class="btn-voltar" onclick="UI.voltarLobby()">VOLTAR</button>
    </div>

    <button id="vf-debug-open" type="button" style="
      position:fixed; right:10px; bottom:10px; z-index:9999;
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.85);
      border: 1px solid rgba(255,255,255,.12);
      padding: 8px 10px;
      border-radius: 12px;
      font-weight: 900;
      font-size: 12px;
    ">DEBUG</button>

    <!-- Engine -->
    <script defer src="engine/database.js"></script>
    <script defer src="engine/save.js"></script>
    <script defer src="engine/tactics.js"></script>
    <script defer src="engine/match.js"></script>
    <script defer src="engine/league.js"></script>

    <!-- ✅ NOVO: FINANÇAS -->
    <script defer src="engine/finances.js"></script>

    <script defer src="engine/market.js"></script>
    <script defer src="engine/calendar.js"></script>
    <script defer src="engine/cup.js"></script>
    <script defer src="engine/cup_integration.js"></script>

    <!-- UI -->
    <script defer src="Ui/ui.js"></script>
    <script defer src="Ui/league-ui.js"></script>
    <script defer src="Ui/market-ui.js"></script>
    <script defer src="Ui/team-ui.js"></script>
    <script defer src="Ui/tactics-ui.js"></script>
    <script defer src="Ui/calendar-ui.js"></script>

    <!-- AAA extras se existirem -->
    <script defer src="engine/post-match.js"></script>
    <script defer src="Ui/post-match-ui.js"></script>
    <script defer src="engine/season-calendar.js"></script>
    <script defer src="Ui/season-calendar-ui.js"></script>
    <script defer src="Ui/lobby-hub-ui.js"></script>
    <script defer src="Ui/debug-panel-ui.js"></script>

    <script defer src="main.js"></script>
</body>
</html>